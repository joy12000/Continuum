# Work.md — Continuum 중간 점검 (2025-08-19)

## 0) 한줄 요약
- **생성형 RAG 기본 · 추출형 폴백**으로 전환했고, **3일 간격 자동 백업**까지 구현됨. 남은 핵심은 **출처 하이라이트 매핑**과 **프롬프트 품질 튜닝**.

---

## 1) 진행 상황 (완료/DONE)
- **PWA 골격**: React+Vite, 설치/오프라인 캐시, 서비스워커.
- **데이터 저장**: IndexedDB(Dexie) `notes` 스키마.
- **검색 파이프라인**: BM25 + 시맨틱(해시/원격) + RRF, RAG 후보 생성은 **Web Worker**에서 수행.
- **RAG(추출형)**: 요점 3줄 + 출처 카드, MMR 다양성 재랭크.
- **RAG(생성형)**: 기본 모드로 활성. `/generate` 엔드포인트 연동(설정에서 URL 입력) → 실패/오프라인 시 **추출형 폴백**.
- **설정(Settings)**: 생성형 기본 토글, Generate API URL, 자동 백업 ON/OFF + 주기(일), 마지막 백업 시각 표기.
- **자동 백업**: 기본 ON, **3일 간격**으로 JSON 백업 자동 다운로드.
- **무결성/안정성**: 백업 **자가검증(Self‑check)**, ErrorBoundary, Toasts.
- **중복 관리**: Dedup 제안(코사인≥0.92, 상위 500개), 1클릭 병합.
- **진단 패널**: 엔진/어댑터/노트/스토리지/UA 표시.

---

## 2) 결정 사항 (확정/LOCK)
1. **RAG 기본 모드**: 생성형 기본, 추출형은 토글/폴백.
2. **규칙 필터(숫자·부정)**: 추후 추가(후순위로 이관).
3. **자동 백업 주기**: 3일 간격 기본 ON.
4. **Dedup 임계값**: 0.92로 시작 → 실데이터 허위 그룹률 보고 **0.90~0.95** 미세 조정.
5. **비용/임베딩 정책**: 무료 티어가 빡빡하면 **온디바이스(ONNX+int8) 우선**.
6. **검색 워커(메인 파이프라인)**: **다음 스프린트**에서 연결.

---

## 3) 스프린트 목표 (상태: ✅/🟡/⬜)
### P0 — 생성형 기본화 & 품질 튜닝 (현재 스프린트)
- ✅ 생성형 기본 및 폴백 로직 구현
- 🟡 **출처 하이라이트 매핑**(생성 불릿 ↔ 인용 문장 앵커)
- 🟡 **프롬프트 v1**: 근거 내 생성, 수치/단위 보존, 불확실 표기, 금지어(환각 유발) 차단
- 🟡 α/λ 프리셋 A/B(0.3/0.4/0.5, 0.5/0.6) 실측
- ⬜ 미니 벤치(속도/정확도) 페이지

### P1 — 안정성/무결성 강화
- ✅ 자동 백업(3일) + UI
- ✅ 백업 자가검증(개수) → ⬜ **내용 해시** 비교 추가
- ⬜ 로컬 오류 로그(최근 20개)

### P2 — 성능 고정(보류)
- ⬜ **검색 워커 연결**(BM25/코사인/정렬 오프로딩), 1천 노트 <150ms 목표

### P3 — 온디바이스 모델 편의
- ⬜ 모델 다운로드 진행률/재개 UI, int8 우선 자동 감지

### P4 — 규칙 필터
- ⬜ `-제외`, `≤/≥/이하/이상` 패턴 컷 + 하이라이트 검증

---

## 4) 리스크 & 대응
- **원격 LLM 쿼터/비용**: 기본 생성형이지만 실패/초과 시 **추출형 폴백**(오프라인 0원 유지).
- **대량 데이터에서 UI 끊김**: 검색 워커 전환 준비됨(다음 스프린트). 임시로 후보 슬라이스/가상화 유지.
- **숫자·부정 제약 정확도**: 규칙 필터 후순위로 이관, BM25 가중/하이라이트로 상쇄.
- **모델 초기 다운로드 체감**: 진행률/재개 UI, PWA 캐시, **int8 권장**.

---

## 5) 성공 지표(AC)
- **Ask(생성형)**: Top‑K 준비 상태에서 응답 ≤ **1.5s**, 핵심 문장에 **[출처]** 유지.
- **Ask(추출형)** 폴백: 응답 ≤ **1.0s**, 요점 3줄 + 인용 3~5개.
- **검색**: 1천 노트 기준 < **150ms**(워커 전환 후).
- **백업/복원**: 개수·내용 해시 **일치**.
- **Dedup**: 허위 그룹률 < **10%**(실데이터 측정 기반 임계값 조정).

---

## 6) 다음 액션(즉시 수행)
- [ ] **출처 하이라이트 매핑**(문장 유사도 기반 번호 앵커)
- [ ] **프롬프트 v1** 반영 및 템플릿화(근거 내 생성/불확실 표기/수치 보존)
- [ ] **자가검증(내용 해시)** 추가
- [ ] Dedup 임계값 로깅 옵션(허위/정상 라벨 토글) → 추천치 계산

---

## 7) 요청/메모
- Generate API를 사용할 경우 **프록시 URL**만 설정에 입력(키는 서버에 보관). 미설정·오프라인은 자동 폴백.
- 검색 워커 연결은 **다음 스프린트**에서 수행(성능 고정 단계).

---

## 8) 변경 이력
- 2025-08-19 — 생성형 기본화 + 자동 백업(3일) 반영, Work.md 갱신.
